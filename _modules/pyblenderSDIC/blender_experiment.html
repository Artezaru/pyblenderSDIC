
<!DOCTYPE html>


<html lang="en" data-content_root="../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>pyblenderSDIC.blender_experiment &#8212; pyblenderSDIC 1.0.3 documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=8f2a1f02" />
  
  <!-- So that users can add custom icons -->
  <script src="../../_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="../../_static/documentation_options.js?v=baaebd52"></script>
    <script src="../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = '_modules/pyblenderSDIC/blender_experiment';</script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">

  
    
  

<a class="navbar-brand logo" href="../../index.html">
  
  
  
  
  
  
    <p class="title logo__title">pyblenderSDIC 1.0.3 documentation</p>
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../installation.html">
    Installation
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../api.html">
    API Reference
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../usage.html">
    Usage
  </a>
</li>

  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
        </div>
      
      
        <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
    </div>
  

  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
        
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar hide-on-wide">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../installation.html">
    Installation
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../api.html">
    API Reference
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../usage.html">
    Usage
  </a>
</li>

  </ul>
</nav></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
        
      </div>
    
  </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">

<nav aria-label="Breadcrumb" class="d-print-none">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="../index.html" class="nav-link">Module code</a></li>
    
    <li class="breadcrumb-item active" aria-current="page"><span class="ellipsis">pyblenderSDIC.blender_experiment</span></li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <h1>Source code for pyblenderSDIC.blender_experiment</h1><div class="highlight"><pre>
<span></span><span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">bpy</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">bmesh</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">bpy_types</span><span class="w"> </span><span class="kn">import</span> <span class="n">Object</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Import failed for BLENDER EXPERIMENT. Running in Blender environment.&quot;</span><span class="p">)</span>
    <span class="n">Object</span> <span class="o">=</span> <span class="kc">None</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">List</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">numbers</span><span class="w"> </span><span class="kn">import</span> <span class="n">Integral</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.camera</span><span class="w"> </span><span class="kn">import</span> <span class="n">Camera</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.materials.material_bsdf</span><span class="w"> </span><span class="kn">import</span> <span class="n">MaterialBSDF</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.spotlight</span><span class="w"> </span><span class="kn">import</span> <span class="n">SpotLight</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">meshio</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span>

<div class="viewcode-block" id="BlenderExperiment">
<a class="viewcode-back" href="../../api_doc/blender_experiment.html#pyblenderSDIC.BlenderExperiment">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">BlenderExperiment</span><span class="p">:</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Represents a Blender experiment with a defined scene and objects.</span>

<span class="sd">    The BlenderExperiment class provides methods to add and configure cameras, spot lights, and objects (mesh + material) in a Blender scene.</span>
<span class="sd">    The class also allows setting the properties of the scene such as resolution and pixel aspect ratio.</span>
<span class="sd">    Then the class provides methods to render the scene and save the rendered images.</span>

<span class="sd">    The number of frames in the experiment can be set using the `end_frame` parameter.</span>
<span class="sd">    This parameters can not be updated after the experiment is created.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    Nb_frames : int, optional</span>
<span class="sd">        The number of frames for the experiment (default is 1).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Nb_frames</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">Nb_frames</span><span class="p">,</span> <span class="n">Integral</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Nb_frames must be an integer&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">Nb_frames</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Nb_frames must be greater than or equal to 1&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_end_frame</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">Nb_frames</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_camera_objects</span> <span class="o">=</span> <span class="p">{}</span> <span class="c1"># {&quot;name&quot; : List[Camera, List[bool]]}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_spotlight_objects</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mesh_objects</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_active_camera</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_active_frame</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_reset_blender</span><span class="p">()</span>

        
    <span class="c1"># =======================================================</span>
    <span class="c1"># Reset Blender</span>
    <span class="c1"># =======================================================</span>
<div class="viewcode-block" id="BlenderExperiment._reset_blender">
<a class="viewcode-back" href="../../api_doc/blender_experiment.html#pyblenderSDIC.BlenderExperiment._reset_blender">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">_reset_blender</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Resets the Blender environment.</span>

<span class="sd">        - Removes all objects in the active scene.</span>
<span class="sd">        - Deletes all meshes, materials, textures, armatures, cameras, lights, and collections.</span>
<span class="sd">        - Initializes a new scene for the experiment.</span>
<span class="sd">        - Resets the 3D cursor to the origin.</span>
<span class="sd">        - Sets the start and end frames to 1.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Deleting all objects in the active scene</span>
        <span class="n">bpy</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">select_all</span><span class="p">(</span><span class="n">action</span><span class="o">=</span><span class="s1">&#39;SELECT&#39;</span><span class="p">)</span>
        <span class="n">bpy</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">object</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
        <span class="c1"># Deleting all meshes</span>
        <span class="k">for</span> <span class="n">mesh</span> <span class="ow">in</span> <span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">meshes</span><span class="p">:</span>
            <span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">meshes</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">mesh</span><span class="p">)</span>
        <span class="c1"># Deleting all materials</span>
        <span class="k">for</span> <span class="n">material</span> <span class="ow">in</span> <span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">materials</span><span class="p">:</span>
            <span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">materials</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">material</span><span class="p">)</span>
        <span class="c1"># Deleting all textures</span>
        <span class="k">for</span> <span class="n">texture</span> <span class="ow">in</span> <span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">textures</span><span class="p">:</span>
            <span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">textures</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">texture</span><span class="p">)</span>
        <span class="c1"># Deleting all armatures</span>
        <span class="k">for</span> <span class="n">armature</span> <span class="ow">in</span> <span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">armatures</span><span class="p">:</span>
            <span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">armatures</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">armature</span><span class="p">)</span>
        <span class="c1"># Deleting all cameras</span>
        <span class="k">for</span> <span class="n">camera</span> <span class="ow">in</span> <span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">cameras</span><span class="p">:</span>
            <span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">cameras</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">camera</span><span class="p">)</span>
        <span class="c1"># Deleting all lights</span>
        <span class="k">for</span> <span class="n">light</span> <span class="ow">in</span> <span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">lights</span><span class="p">:</span>
            <span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">lights</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">light</span><span class="p">)</span>
        <span class="c1"># Deleting all collections</span>
        <span class="k">for</span> <span class="n">collection</span> <span class="ow">in</span> <span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">collections</span><span class="p">:</span>
            <span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">collections</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">collection</span><span class="p">)</span>
        <span class="c1"># Clearing all dictionaries</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_camera_objects</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_spotlight_objects</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mesh_objects</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_active_camera</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_active_frame</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="c1"># Initializing of the blender scene</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_experiment_scene</span> <span class="o">=</span> <span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">scenes</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;experiment_scene&quot;</span><span class="p">)</span>
        <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">location</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>  <span class="c1"># Reset 3D cursor</span>
        <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">frame_start</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># Start frame</span>
        <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">frame_end</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_end_frame</span> <span class="o">+</span> <span class="mi">1</span> <span class="c1"># End frame </span></div>



    <span class="c1"># =======================================================</span>
    <span class="c1"># Blender Scene Management (CAMERA)</span>
    <span class="c1"># =======================================================</span>
<div class="viewcode-block" id="BlenderExperiment.add_camera">
<a class="viewcode-back" href="../../api_doc/blender_experiment.html#pyblenderSDIC.BlenderExperiment.add_camera">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">add_camera</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">camera</span><span class="p">:</span> <span class="n">Camera</span><span class="p">,</span> <span class="n">frames</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">bool</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add a camera to the experiment.</span>

<span class="sd">        The frames parameter indicates which frames the camera will be active.</span>
<span class="sd">        If None, the camera will be active for all frames.</span>
<span class="sd">        Else a list of booleans must be provided, where each boolean indicates if the camera is active for that frame.</span>

<span class="sd">        .. code-block:: python</span>

<span class="sd">            # Example usage</span>
<span class="sd">            experiment = BlenderExperiment(Nb_frames=10)</span>
<span class="sd">            camera = Camera()</span>
<span class="sd">            # Define the camera properties here</span>
<span class="sd">            # ...</span>
<span class="sd">            experiment.add_camera(name=&quot;Camera1&quot;, camera=camera, frames=[True, False, True, False, True, False, True, False, True, False])</span>

<span class="sd">        .. note::</span>

<span class="sd">            The name of the camera must be unique in the experiment and in Blender data.</span>
<span class="sd">            Furthemore, because Blender limits the name of the objects to 63 characters and ``pyblenderSDIC`` add prefixe for sub-dependant object of the camera,</span>
<span class="sd">            the name of the camera must be less than 50 characters.</span>

<span class="sd">        .. seealso::</span>

<span class="sd">            - :class:`pyblenderSDIC.Camera` for more information on how to define a camera.</span>
<span class="sd">            - :meth:`pyblenderSDIC.BlenderExperiment.update_camera` to update the camera properties in the Blender scene.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        name : str</span>
<span class="sd">            The name of the camera with less than 50 characters.</span>
<span class="sd">        </span>
<span class="sd">        camera : Camera</span>
<span class="sd">            The camera object to be added. </span>

<span class="sd">        frames : List[bool], optional</span>
<span class="sd">            A list of booleans indicating which frames the camera will be active.</span>
<span class="sd">            If None, the camera will be active for all frames (default is None).</span>

<span class="sd">        Raises</span>
<span class="sd">        -------</span>
<span class="sd">        TypeError</span>
<span class="sd">            If name is not a string or camera is not an instance of Camera.</span>
<span class="sd">        ValueError</span>
<span class="sd">            If a camera with the same name already exists in the experiment or in Blender data.</span>
<span class="sd">            If the length of frames is not equal to the number of frames in the experiment (end_frame).</span>
<span class="sd">            If the camera is not completely defined.</span>

<span class="sd">        Blender Details</span>
<span class="sd">        ---------------</span>
<span class="sd">        The camera is created in the Blender scene and linked to the experiment scene with the name ``{name}``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;name must be a string&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">50</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;name of the camera must be less than 50 characters&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_camera_objects</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Camera with name </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> already exists.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">objects</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Object with name </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> already exists in Blender data.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">camera</span><span class="p">,</span> <span class="n">Camera</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;camera must be an instance of Camera&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">camera</span><span class="o">.</span><span class="n">is_complete</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Camera is not completely defined.&quot;</span><span class="p">)</span>
    
        <span class="c1"># Ensure the experiment scene is active</span>
        <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">scene</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_experiment_scene</span>

        <span class="c1"># Create the camera</span>
        <span class="n">camera_data</span> <span class="o">=</span> <span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">cameras</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
        <span class="n">blender_camera</span> <span class="o">=</span> <span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">camera_data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_camera_objects</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">camera</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="c1"># Store the camera and its frames</span>

        <span class="c1"># Link the camera to the scene</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_experiment_scene</span><span class="o">.</span><span class="n">collection</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">link</span><span class="p">(</span><span class="n">blender_camera</span><span class="p">)</span>

        <span class="c1"># Set the frames for which the camera will be active</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_camera_frames</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">frames</span><span class="p">)</span>

        <span class="c1"># Update the camera properties in the Blender scene</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_camera</span><span class="p">(</span><span class="n">name</span><span class="p">)</span></div>



<div class="viewcode-block" id="BlenderExperiment.set_camera_frames">
<a class="viewcode-back" href="../../api_doc/blender_experiment.html#pyblenderSDIC.BlenderExperiment.set_camera_frames">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">set_camera_frames</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">frames</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">bool</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the frames for which the camera will be active.</span>
<span class="sd">        If None, the camera will be active for all frames.</span>
<span class="sd">        Else a list of booleans must be provided, where each boolean indicates if the camera is active for that frame.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        name : str</span>
<span class="sd">            The name of the camera.</span>
<span class="sd">        </span>
<span class="sd">        frames : List[bool], optional</span>
<span class="sd">            A list of booleans indicating which frames the camera will be active.</span>
<span class="sd">            If None, the camera will be active for all frames (default is None).</span>

<span class="sd">        Raises</span>
<span class="sd">        -------</span>
<span class="sd">        TypeError</span>
<span class="sd">            If name is not a string or frames is not a list of booleans.</span>
<span class="sd">        ValueError</span>
<span class="sd">            If a camera with the same name does not exist in the experiment or in Blender data.</span>
<span class="sd">            If the length of frames is not equal to the number of frames in the experiment (end_frame).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;name must be a string&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_camera_objects</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Camera with name </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> does not exist.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">objects</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No object with name </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> in Blender data.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">frames</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">frames</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;frames must be a list of booleans&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">frames</span><span class="p">)</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_end_frame</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Length of frames must be equal to </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_end_frame</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">frame</span> <span class="ow">in</span> <span class="n">frames</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;frames must be a list of booleans&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">frames</span> <span class="o">=</span> <span class="p">[</span><span class="kc">True</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_end_frame</span>
        
        <span class="c1"># Ensure the experiment scene is active</span>
        <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">scene</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_experiment_scene</span>

        <span class="c1"># Set the frames for which the camera will be active</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_camera_objects</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">frames</span></div>



<div class="viewcode-block" id="BlenderExperiment.get_camera_frames">
<a class="viewcode-back" href="../../api_doc/blender_experiment.html#pyblenderSDIC.BlenderExperiment.get_camera_frames">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_camera_frames</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">bool</span><span class="p">]:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the frames for which the camera is active.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        name : str</span>
<span class="sd">            The name of the camera.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        List[bool]</span>
<span class="sd">            A list of booleans indicating which frames the camera is active.</span>
<span class="sd">        </span>
<span class="sd">        Raises</span>
<span class="sd">        -------</span>
<span class="sd">        TypeError</span>
<span class="sd">            If name is not a string.</span>
<span class="sd">        ValueError</span>
<span class="sd">            If a camera with the same name does not exist in the experiment or in Blender data.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;name must be a string&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_camera_objects</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Camera with name </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> does not exist.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">objects</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No object with name </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> in Blender data.&quot;</span><span class="p">)</span>
        
        <span class="c1"># Ensure the experiment scene is active</span>
        <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">scene</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_experiment_scene</span>

        <span class="c1"># Get the frames for which the camera is active</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_camera_objects</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span></div>



<div class="viewcode-block" id="BlenderExperiment.get_camera">
<a class="viewcode-back" href="../../api_doc/blender_experiment.html#pyblenderSDIC.BlenderExperiment.get_camera">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_camera</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Camera</span><span class="p">,</span> <span class="n">Object</span><span class="p">]:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the camera object and its Blender object.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        name : str</span>
<span class="sd">            The name of the camera to retrieve.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Tuple[Camera, Object]</span>
<span class="sd">            A tuple containing the Camera object and its corresponding Blender object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;name must be a string&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_camera_objects</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Camera with name </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> does not exist.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">objects</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No object with name </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> in Blender data.&quot;</span><span class="p">)</span>
        
        <span class="c1"># Ensure the experiment scene is active</span>
        <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">scene</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_experiment_scene</span>

        <span class="c1"># Get the camera object</span>
        <span class="n">camera</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_camera_objects</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">blender_camera</span> <span class="o">=</span> <span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">objects</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>

        <span class="c1"># Check the types of the objects</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">camera</span><span class="p">,</span> <span class="n">Camera</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;[ERROR] camera must be an instance of Camera&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">blender_camera</span><span class="p">,</span> <span class="n">Object</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;[ERROR] blender_camera must be an instance of Object&quot;</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">camera</span><span class="p">,</span> <span class="n">blender_camera</span></div>

    

<div class="viewcode-block" id="BlenderExperiment.get_camera_names">
<a class="viewcode-back" href="../../api_doc/blender_experiment.html#pyblenderSDIC.BlenderExperiment.get_camera_names">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_camera_names</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the names of all cameras in the experiment.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        List[str]</span>
<span class="sd">            A list of camera names.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_camera_objects</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span></div>

    

<div class="viewcode-block" id="BlenderExperiment.remove_camera">
<a class="viewcode-back" href="../../api_doc/blender_experiment.html#pyblenderSDIC.BlenderExperiment.remove_camera">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">remove_camera</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Remove a camera from the experiment.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        name : str</span>
<span class="sd">            The name of the camera to remove.</span>

<span class="sd">        Raises</span>
<span class="sd">        -------</span>
<span class="sd">        TypeError</span>
<span class="sd">            If name is not a string.</span>
<span class="sd">        ValueError</span>
<span class="sd">            If a camera with the same name does not exist in the experiment or in Blender data.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;name must be a string&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_camera_objects</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Camera with name </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> does not exist.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">objects</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No object with name </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> in Blender data.&quot;</span><span class="p">)</span>
        
        <span class="c1"># Ensure the experiment scene is active</span>
        <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">scene</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_experiment_scene</span>

        <span class="c1"># Remove the camera from the scene</span>
        <span class="n">camera</span><span class="p">,</span> <span class="n">blender_camera</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_camera</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">blender_camera</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_camera_objects</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

        <span class="c1"># Set active camera to None if it was removed</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_active_camera</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_active_camera</span> <span class="o">==</span> <span class="n">name</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_active_camera</span> <span class="o">=</span> <span class="kc">None</span></div>



<div class="viewcode-block" id="BlenderExperiment.update_camera">
<a class="viewcode-back" href="../../api_doc/blender_experiment.html#pyblenderSDIC.BlenderExperiment.update_camera">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">update_camera</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update the camera properties in the Blender scene.</span>
<span class="sd">        This method must be called after updating the camera properties in the Camera object.</span>

<span class="sd">        .. code-block:: python</span>

<span class="sd">            # Example usage</span>
<span class="sd">            experiment = BlenderExperiment(Nb_frames=10)</span>
<span class="sd">            camera = Camera()</span>
<span class="sd">            # Define the camera properties here</span>
<span class="sd">            # ...</span>
<span class="sd">            experiment.add_camera(name=&quot;Camera1&quot;, camera=camera, frames=[True, False, True, False, True, False, True, False, True, False])</span>
<span class="sd">            # Update some properties of the camera here</span>
<span class="sd">            # ...</span>
<span class="sd">            experiment.update_camera(name=&quot;Camera1&quot;) # To set active the modifications in the Blender scene</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        name : str</span>
<span class="sd">            The name of the camera to update.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;name must be a string&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_camera_objects</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Camera with name </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> does not exist.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">objects</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No object with name </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> in Blender data.&quot;</span><span class="p">)</span>

        <span class="c1"># Ensure the experiment scene is active</span>
        <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">scene</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_experiment_scene</span>

        <span class="c1"># Get the camera object</span>
        <span class="n">camera</span><span class="p">,</span> <span class="n">blender_camera</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_camera</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">camera</span><span class="o">.</span><span class="n">is_complete</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Camera is not completely defined.&quot;</span><span class="p">)</span>

        <span class="c1"># Set the lens unit of the camera</span>
        <span class="n">blender_camera</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">lens_unit</span> <span class="o">=</span> <span class="s1">&#39;MILLIMETERS&#39;</span>

        <span class="c1"># Set the position and rotation of the camera</span>
        <span class="n">rotation</span><span class="p">,</span> <span class="n">translation</span> <span class="o">=</span> <span class="n">camera</span><span class="o">.</span><span class="n">get_OpenGL_RT</span><span class="p">()</span>
        <span class="n">blender_camera</span><span class="o">.</span><span class="n">location</span> <span class="o">=</span> <span class="n">translation</span>
        <span class="n">blender_quaternion</span> <span class="o">=</span> <span class="n">rotation</span><span class="o">.</span><span class="n">as_quat</span><span class="p">(</span><span class="n">scalar_first</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1"># blender convention [qw, qx, qy, qz]</span>
        <span class="n">blender_camera</span><span class="o">.</span><span class="n">rotation_mode</span> <span class="o">=</span> <span class="s1">&#39;QUATERNION&#39;</span>
        <span class="n">blender_camera</span><span class="o">.</span><span class="n">rotation_quaternion</span> <span class="o">=</span> <span class="n">blender_quaternion</span> 

        <span class="c1"># Set the clipping of the camera</span>
        <span class="k">if</span> <span class="n">camera</span><span class="o">.</span><span class="n">clnear</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">blender_camera</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">clip_start</span> <span class="o">=</span> <span class="n">camera</span><span class="o">.</span><span class="n">clnear</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">blender_camera</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">clip_start</span> <span class="o">=</span> <span class="mf">1e-6</span> <span class="c1"># Lower limit for the near clipping plane</span>
        <span class="k">if</span> <span class="n">camera</span><span class="o">.</span><span class="n">clfar</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">blender_camera</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">clip_end</span> <span class="o">=</span> <span class="n">camera</span><span class="o">.</span><span class="n">clfar</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">blender_camera</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">clip_end</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">inf</span> <span class="c1"># Upper limit for the far clipping plane</span>

        <span class="c1"># Set the focal length of the camera</span>
        <span class="k">if</span> <span class="n">camera</span><span class="o">.</span><span class="n">lens</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Focal length must be greater than 1 millimeter for Blender.&quot;</span><span class="p">)</span>
        <span class="n">blender_camera</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">lens</span> <span class="o">=</span> <span class="n">camera</span><span class="o">.</span><span class="n">lens</span>

        <span class="c1"># Set size of the sensor</span>
        <span class="n">blender_camera</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">sensor_width</span> <span class="o">=</span> <span class="n">camera</span><span class="o">.</span><span class="n">sensor_width</span>
        <span class="n">blender_camera</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">sensor_height</span> <span class="o">=</span> <span class="n">camera</span><span class="o">.</span><span class="n">sensor_height</span>
        <span class="n">blender_camera</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">sensor_fit</span> <span class="o">=</span> <span class="n">camera</span><span class="o">.</span><span class="n">sensor_fit</span>

        <span class="c1"># Set the shift of the camera</span>
        <span class="n">blender_camera</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shift_x</span> <span class="o">=</span> <span class="n">camera</span><span class="o">.</span><span class="n">shift_x</span>
        <span class="n">blender_camera</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shift_y</span> <span class="o">=</span> <span class="n">camera</span><span class="o">.</span><span class="n">shift_y</span>

        <span class="c1"># Update the active camera if it is the current one</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_active_camera</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_active_camera</span> <span class="o">==</span> <span class="n">name</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_active_camera</span><span class="p">(</span><span class="n">name</span><span class="p">)</span></div>



<div class="viewcode-block" id="BlenderExperiment.set_active_camera">
<a class="viewcode-back" href="../../api_doc/blender_experiment.html#pyblenderSDIC.BlenderExperiment.set_active_camera">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">set_active_camera</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the active camera for the experiment.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        name : str</span>
<span class="sd">            The name of the camera to set as active.</span>

<span class="sd">        Raises</span>
<span class="sd">        -------</span>
<span class="sd">        TypeError</span>
<span class="sd">            If name is not a string.</span>
<span class="sd">        ValueError</span>
<span class="sd">            If a camera with the same name does not exist in the experiment or in Blender data.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;name must be a string&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_camera_objects</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Camera with name </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> does not exist.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">objects</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No object with name </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> in Blender data.&quot;</span><span class="p">)</span>

        <span class="c1"># Ensure the experiment scene is active</span>
        <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">scene</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_experiment_scene</span>

        <span class="c1"># Get the camera object</span>
        <span class="n">camera</span><span class="p">,</span> <span class="n">blender_camera</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_camera</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">camera</span><span class="o">.</span><span class="n">is_complete</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Camera is not completely defined.&quot;</span><span class="p">)</span>
        
        <span class="c1"># Set the active camera</span>
        <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">camera</span> <span class="o">=</span> <span class="n">blender_camera</span>

        <span class="c1"># Configure the scene properties using the camera&#39;s parameters</span>
        <span class="n">render</span> <span class="o">=</span> <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">render</span>

        <span class="c1"># Set the resolution</span>
        <span class="n">render</span><span class="o">.</span><span class="n">resolution_x</span> <span class="o">=</span> <span class="n">camera</span><span class="o">.</span><span class="n">rx</span>
        <span class="n">render</span><span class="o">.</span><span class="n">resolution_y</span> <span class="o">=</span> <span class="n">camera</span><span class="o">.</span><span class="n">ry</span>

        <span class="c1"># Set the pixel aspect ratio</span>
        <span class="n">render</span><span class="o">.</span><span class="n">pixel_aspect_x</span> <span class="o">=</span> <span class="n">camera</span><span class="o">.</span><span class="n">pixel_aspect_x</span>
        <span class="n">render</span><span class="o">.</span><span class="n">pixel_aspect_y</span> <span class="o">=</span> <span class="n">camera</span><span class="o">.</span><span class="n">pixel_aspect_y</span>

        <span class="c1"># Set the active camera</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_active_camera</span> <span class="o">=</span> <span class="n">name</span></div>



<div class="viewcode-block" id="BlenderExperiment.get_active_camera">
<a class="viewcode-back" href="../../api_doc/blender_experiment.html#pyblenderSDIC.BlenderExperiment.get_active_camera">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_active_camera</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the name of the active camera.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        str</span>
<span class="sd">            The name of the active camera.</span>
<span class="sd">        </span>
<span class="sd">        Raises</span>
<span class="sd">        -------</span>
<span class="sd">        ValueError</span>
<span class="sd">            If no active camera is set.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_active_camera</span></div>





    <span class="c1"># =======================================================</span>
    <span class="c1"># Blender Scene Management (MESH)</span>
    <span class="c1"># =======================================================</span>
<div class="viewcode-block" id="BlenderExperiment.add_mesh">
<a class="viewcode-back" href="../../api_doc/blender_experiment.html#pyblenderSDIC.BlenderExperiment.add_mesh">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">add_mesh</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">mesh</span><span class="p">:</span> <span class="n">meshio</span><span class="o">.</span><span class="n">Mesh</span><span class="p">,</span> <span class="n">frames</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">bool</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add a mesh to the experiment.</span>

<span class="sd">        The mesh must be an instance of meshio.Mesh with the following structure:</span>

<span class="sd">        - ``points``: A NumPy array of shape (N, 3) representing the coordinates of N mesh nodes.</span>
<span class="sd">        - ``cells_dict{&quot;triangle&quot;}.data``: A NumPy array of shape (M, 3) representing M triangular elements defined by node indices.</span>
<span class="sd">        - ``point_data``: A dictionary storing data associated with each point, such as &quot;uvmap&quot; a (N, 3) array of texture coordinates (only the first two columns are used).</span>

<span class="sd">        The frames parameter indicates which frames the mesh will be active.</span>
<span class="sd">        If None, the mesh will be active for all frames.</span>
<span class="sd">        Else a list of booleans must be provided, where each boolean indicates if the mesh is active for that frame.</span>

<span class="sd">        .. note::</span>

<span class="sd">            The name of the mesh must be unique in the experiment and in Blender data.</span>
<span class="sd">            Furthemore, because Blender limits the name of the objects to 63 characters and ``pyblenderSDIC`` add prefixe for sub-dependant object of the mesh,</span>
<span class="sd">            the name of the mesh must be less than 50 characters.</span>

<span class="sd">        .. code-block:: python</span>

<span class="sd">            # Example usage</span>
<span class="sd">            experiment = BlenderExperiment(Nb_frames=10)</span>
<span class="sd">            # Define the mesh properties here</span>
<span class="sd">            # ...</span>
<span class="sd">            mesh = meshio.Mesh(points, cells_dict={&quot;triangle&quot;: elements}, point_data={&quot;uvmap&quot;: texture_coordinates})</span>
<span class="sd">            experiment.add_mesh(name=&quot;Mesh1&quot;, mesh=mesh, frames=[True, False, True, False, True, False, True, False, True, False])</span>

<span class="sd">        .. seealso::</span>

<span class="sd">            - :class:`pyblenderSDIC.meshio.Mesh` for more information on how to define a mesh.</span>
<span class="sd">            - :meth:`pyblenderSDIC.BlenderExperiment.update_mesh` to update the mesh properties in the Blender scene.</span>
<span class="sd">            - :meth:`pyblenderSDIC.BlenderExperiment.add_mesh_material` to set the material of the mesh.</span>
<span class="sd">            - :meth:`pyblenderSDIC.BlenderExperiment.add_mesh_pattern` to set the pattern image of the mesh.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        name : str</span>
<span class="sd">            The name of the mesh with less than 50 characters.</span>
<span class="sd">        </span>
<span class="sd">        mesh : meshio.Mesh</span>
<span class="sd">            The mesh object to be added. </span>

<span class="sd">        frames : List[bool], optional</span>
<span class="sd">            A list of booleans indicating which frames the mesh will be active.</span>
<span class="sd">            If None, the mesh will be active for all frames (default is None).</span>

<span class="sd">        Raises</span>
<span class="sd">        -------</span>
<span class="sd">        TypeError</span>
<span class="sd">            If name is not a string or mesh is not an instance of meshio.Mesh.</span>
<span class="sd">        ValueError</span>
<span class="sd">            If a mesh with the same name already exists in the experiment or in Blender data.</span>
<span class="sd">            If the length of frames is not equal to the number of frames in the experiment (end_frame).</span>
<span class="sd">            If the mesh is not completely defined.</span>

<span class="sd">        Blender Details</span>
<span class="sd">        ---------------</span>
<span class="sd">        The mesh is created in the Blender scene and linked to the experiment scene.</span>
<span class="sd">        The mesh name is set to the provided name.</span>

<span class="sd">        A material is created for the mesh with the name ``[pbSDIC]_{name}_mat``.</span>
<span class="sd">        The material uses a Principled BSDF shader and is set to ``use_nodes = True``.</span>
<span class="sd">        The material is located at the first index of the mesh data materials.</span>

<span class="sd">        A MixRGB node is created at the input of the Principled BSDF ``Base Color`` node.</span>
<span class="sd">        The MixRGB node name is set to ``[pbSDIC]_{name}_mbp`` for &quot;Mix BaseColor Pattern&quot;.</span>

<span class="sd">        The first input of the MixRGB node is the default base color of the material (white).</span>
<span class="sd">        It can be setted to any color using the ``add_mesh_material`` method.</span>

<span class="sd">        The second input of the MixRGB node is the default pattern of the material (white).</span>
<span class="sd">        It can be setted to any pattern using the ``add_mesh_pattern`` method.</span>

<span class="sd">        The output of the MixRGB node is connected to the ``Base Color`` input of the Principled BSDF node.          </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;name must be a string&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">50</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;name of the mesh must be less than 50 characters&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mesh_objects</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Mesh with name </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> already exists.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">objects</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Object with name </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> already exists in Blender data.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">meshio</span><span class="o">.</span><span class="n">Mesh</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;mesh must be an instance of meshio.Mesh&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="s1">&#39;triangle&#39;</span> <span class="ow">in</span> <span class="n">mesh</span><span class="o">.</span><span class="n">cells_dict</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;mesh must contain a &#39;triangle&#39; cell type&quot;</span><span class="p">)</span>
        
        <span class="c1"># Ensure the experiment scene is active</span>
        <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">scene</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_experiment_scene</span>

        <span class="c1"># Extract the vertices and faces from the mesh</span>
        <span class="n">points</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">points</span>
        <span class="n">cells</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">cells_dict</span><span class="p">[</span><span class="s2">&quot;triangle&quot;</span><span class="p">]</span>
        
        <span class="c1"># ======================</span>
        <span class="c1"># MESH CREATION</span>
        <span class="c1"># ======================</span>

        <span class="c1"># Create the mesh</span>
        <span class="n">mesh_data</span> <span class="o">=</span> <span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">meshes</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
        <span class="n">blender_mesh</span> <span class="o">=</span> <span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">mesh_data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mesh_objects</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">mesh</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>

        <span class="c1"># Convert the points and cells to a format compatible with Blender</span>
        <span class="n">points</span> <span class="o">=</span> <span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">point</span><span class="p">)</span> <span class="k">for</span> <span class="n">point</span> <span class="ow">in</span> <span class="n">points</span><span class="p">]</span>
        <span class="n">faces</span> <span class="o">=</span> <span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">face</span><span class="p">)</span> <span class="k">for</span> <span class="n">face</span> <span class="ow">in</span> <span class="n">cells</span><span class="p">]</span>

        <span class="c1"># Set the vertices and faces of the Blender mesh</span>
        <span class="n">blender_mesh</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">from_pydata</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="p">[],</span> <span class="n">faces</span><span class="p">)</span>

        <span class="c1"># =======================</span>
        <span class="c1"># Material CREATION</span>
        <span class="c1"># =======================</span>

        <span class="c1"># Creating the material</span>
        <span class="k">if</span> <span class="sa">f</span><span class="s1">&#39;[pbSDIC]_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">_mat&#39;</span> <span class="ow">in</span> <span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">materials</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Material with name [pbSDIC]_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">_mat already exists.&quot;</span><span class="p">)</span>

        <span class="n">blender_material</span> <span class="o">=</span> <span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">materials</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;[pbSDIC]_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">_mat&#39;</span><span class="p">)</span>
        <span class="n">blender_material</span><span class="o">.</span><span class="n">use_nodes</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># Assign the material to the object</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">blender_mesh</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">materials</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">blender_mesh</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">materials</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">blender_material</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">blender_mesh</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">materials</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">blender_material</span><span class="p">)</span>

        <span class="c1"># ========================</span>
        <span class="c1"># MIX RGB NODE CREATION</span>
        <span class="c1"># ========================</span>
        <span class="c1"># Here I create a MixRGB node for the base color material.</span>
        <span class="c1"># The idea is :</span>
        <span class="c1"># - The first input of the MixRGB node is the default base color of the material.</span>
        <span class="c1"># - The second input of the MixRGB node is the default pattern of the material (1.0, 1.0, 1.0, 1.0)</span>
        <span class="c1"># - The third input of the MixRGB is anything else.</span>
        <span class="c1">#</span>
        <span class="c1"># If the user add a pattern, we update the second input of the MixRGB node with the pattern.</span>
        <span class="c1"># If the user add a material, we update the first input of the MixRGB node with the color.</span>
        
        <span class="c1"># Access the nodes of the material</span>
        <span class="n">nodes</span> <span class="o">=</span> <span class="n">blender_material</span><span class="o">.</span><span class="n">node_tree</span><span class="o">.</span><span class="n">nodes</span>  <span class="c1"># Access the material&#39;s node tree</span>
        <span class="n">links</span> <span class="o">=</span> <span class="n">blender_material</span><span class="o">.</span><span class="n">node_tree</span><span class="o">.</span><span class="n">links</span>  <span class="c1"># Access node tree links</span>

        <span class="c1"># Create a MixRGB node (type &#39;MIX&#39;) to combine base color and pattern</span>
        <span class="k">if</span> <span class="sa">f</span><span class="s1">&#39;[pbSDIC]_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">_mbp&#39;</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;MixRGB node with name [pbSDIC]_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">_mbp already exists.&quot;</span><span class="p">)</span>

        <span class="n">mix_node</span> <span class="o">=</span> <span class="n">nodes</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;ShaderNodeMixRGB&#39;</span><span class="p">)</span>
        <span class="n">mix_node</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;[pbSDIC]_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">_mbp&#39;</span>
        <span class="n">mix_node</span><span class="o">.</span><span class="n">blend_type</span> <span class="o">=</span> <span class="s1">&#39;MULTIPLY&#39;</span>
        <span class="n">mix_node</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="s1">&#39;Fac&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">default_value</span> <span class="o">=</span> <span class="mf">1.0</span>  <span class="c1"># Full multiplication</span>

        <span class="c1"># Set the default input values for the MixRGB node</span>
        <span class="n">mix_node</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="s1">&#39;Color1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">default_value</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>  <span class="c1"># Default base color (white)</span>
        <span class="n">mix_node</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="s1">&#39;Color2&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">default_value</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>  <span class="c1"># Default pattern (white)</span>

        <span class="c1"># Ensure the Principled BSDF node exists</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="s1">&#39;Principled BSDF&#39;</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No &#39;Principled BSDF&#39; node found in the material. Ensure nodes are enabled.&quot;</span><span class="p">)</span>

        <span class="n">principled</span> <span class="o">=</span> <span class="n">nodes</span><span class="p">[</span><span class="s1">&#39;Principled BSDF&#39;</span><span class="p">]</span>
        <span class="n">input_base_color</span> <span class="o">=</span> <span class="n">principled</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;Base Color&quot;</span><span class="p">]</span>
        <span class="n">existing_link</span> <span class="o">=</span> <span class="n">input_base_color</span><span class="o">.</span><span class="n">links</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">input_base_color</span><span class="o">.</span><span class="n">links</span> <span class="k">else</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">existing_link</span><span class="p">:</span>
            <span class="c1"># disconnect the existing link</span>
            <span class="n">links</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">existing_link</span><span class="p">)</span>
            <span class="c1"># connect the existing link to the MixRGB node `Color1`.</span>
            <span class="n">links</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">existing_link</span><span class="o">.</span><span class="n">from_node</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="n">existing_link</span><span class="o">.</span><span class="n">from_socket</span><span class="o">.</span><span class="n">name</span><span class="p">],</span> <span class="n">mix_node</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="s1">&#39;Color1&#39;</span><span class="p">])</span>

        <span class="c1"># Connect the MixRGB node to the Principled BSDF node</span>
        <span class="n">links</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">mix_node</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="s1">&#39;Color&#39;</span><span class="p">],</span> <span class="n">input_base_color</span><span class="p">)</span>

        <span class="c1"># =========================</span>
        <span class="c1"># FINALIZE MESH</span>
        <span class="c1"># =========================</span>
        <span class="c1"># Update the mesh data</span>
        <span class="n">mesh_data</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>

        <span class="c1"># Link the mesh to the scene</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_experiment_scene</span><span class="o">.</span><span class="n">collection</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">link</span><span class="p">(</span><span class="n">blender_mesh</span><span class="p">)</span>

        <span class="c1"># Set the frames for which the mesh will be active</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_mesh_frames</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">frames</span><span class="p">)</span></div>



<div class="viewcode-block" id="BlenderExperiment.add_mesh_pattern">
<a class="viewcode-back" href="../../api_doc/blender_experiment.html#pyblenderSDIC.BlenderExperiment.add_mesh_pattern">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">add_mesh_pattern</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">pattern_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add a pattern to the mesh material.</span>

<span class="sd">        The pattern must be a valid image file path (e.g., PNG, JPEG).</span>
<span class="sd">        The pattern will be applied to the mesh material as a texture.</span>

<span class="sd">        .. code-block:: python</span>

<span class="sd">            # Example usage</span>
<span class="sd">            experiment = BlenderExperiment(Nb_frames=10)</span>
<span class="sd">            # Define the mesh properties here</span>
<span class="sd">            # ...</span>
<span class="sd">            mesh = meshio.Mesh(points, cells_dict={&quot;triangle&quot;: elements}, point_data={&quot;uvmap&quot;: texture_coordinates})</span>
<span class="sd">            experiment.add_mesh(name=&quot;Mesh1&quot;, mesh=mesh, frames=[True, False, True, False, True, False, True, False, True, False])</span>
<span class="sd">            experiment.add_mesh_pattern(name=&quot;Mesh1&quot;, pattern_path=&quot;path/to/pattern.png&quot;)</span>

<span class="sd">        .. warning::</span>
<span class="sd">        </span>
<span class="sd">            The UV coordinates of the mesh must be defined in the meshio.Mesh object.   </span>
<span class="sd">            as &quot;uvmap&quot; in the point_data dictionary.</span>

<span class="sd">        .. seealso::</span>

<span class="sd">            - :class:`pyblenderSDIC.meshes.TriMesh3D` for more information on how to define a mesh.</span>


<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        name : str</span>
<span class="sd">            The name of the mesh.</span>
<span class="sd">        </span>
<span class="sd">        pattern_path : str</span>
<span class="sd">            The path to the pattern image file.</span>
<span class="sd">        </span>
<span class="sd">        Raises</span>
<span class="sd">        -------</span>
<span class="sd">        TypeError</span>
<span class="sd">            If name is not a string or pattern_path is not a string.</span>
<span class="sd">        ValueError</span>
<span class="sd">            If a mesh with the same name does not exist in the experiment or in Blender data.</span>
<span class="sd">            If the pattern path is not valid or the image format is not supported.</span>
<span class="sd">            If the mesh does not have a UVMAP defined.</span>

<span class="sd">        Blender Details</span>
<span class="sd">        ---------------</span>
<span class="sd">        A ``uv_layer`` is created for the mesh and the UVMAP is set to the texture coordinates defined in the mesh.</span>
<span class="sd">        The uv_layer is named ``[pbSDIC]_{name}_uvm``.</span>

<span class="sd">        A node is created in the material node tree to load the image texture.</span>
<span class="sd">        The node is named ``[pbSDIC]_{name}_imt``.</span>
<span class="sd">        This node is in `CLIP` mode to avoid stretching the image.</span>

<span class="sd">        The color output of the image texture node is connected to the second input of the MixRGB node.</span>
<span class="sd">        The MixRGB node is connected to the Base Color input of the Principled BSDF node in multiply mode.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;name must be a string&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pattern_path</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;pattern_path must be a string&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mesh_objects</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Mesh with name </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> does not exist.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">objects</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No object with name </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> in Blender data.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">pattern_path</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Pattern path </span><span class="si">{</span><span class="n">pattern_path</span><span class="si">}</span><span class="s2"> is not valid.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">pattern_path</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">endswith</span><span class="p">((</span><span class="s1">&#39;.png&#39;</span><span class="p">,</span> <span class="s1">&#39;.jpg&#39;</span><span class="p">,</span> <span class="s1">&#39;.jpeg&#39;</span><span class="p">,</span> <span class="s1">&#39;.bmp&#39;</span><span class="p">,</span> <span class="s1">&#39;.tiff&#39;</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Pattern path </span><span class="si">{</span><span class="n">pattern_path</span><span class="si">}</span><span class="s2"> is not a valid image format.&quot;</span><span class="p">)</span>
        
        <span class="c1"># Ensure the experiment scene is active</span>
        <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">scene</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_experiment_scene</span>

        <span class="c1"># Get the mesh object</span>
        <span class="n">mesh</span><span class="p">,</span> <span class="n">blender_mesh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_mesh</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

        <span class="c1"># Check if the mesh has a UVMAP defined</span>
        <span class="k">if</span> <span class="n">mesh</span><span class="o">.</span><span class="n">point_data</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="s2">&quot;uvmap&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">mesh</span><span class="o">.</span><span class="n">point_data</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Mesh </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> does not have a UVMAP defined.&quot;</span><span class="p">)</span>
        
        <span class="n">uvmap</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">point_data</span><span class="p">[</span><span class="s2">&quot;uvmap&quot;</span><span class="p">]</span> <span class="c1"># (N, 3) array of texture coordinates</span>

        <span class="c1"># Setting the UVMap</span>
        <span class="k">if</span> <span class="sa">f</span><span class="s2">&quot;[pbSDIC]_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">_uvm&quot;</span> <span class="ow">in</span> <span class="n">blender_mesh</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">uv_layers</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;UVMap with name [pbSDIC]_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">_uvm already exists.&quot;</span><span class="p">)</span>
        
        <span class="n">uv_layer</span> <span class="o">=</span> <span class="n">blender_mesh</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">uv_layers</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;[pbSDIC]_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">_uvm&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">loop</span> <span class="ow">in</span> <span class="n">blender_mesh</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">loops</span><span class="p">:</span>
            <span class="n">uv_layer</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">loop</span><span class="o">.</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">uv</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">uvmap</span><span class="p">[</span><span class="n">loop</span><span class="o">.</span><span class="n">vertex_index</span><span class="p">,</span> <span class="p">:</span><span class="mi">2</span><span class="p">])</span>
            
        <span class="c1"># Access the material</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">blender_mesh</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">materials</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Mesh &#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39; has no material assigned.&quot;</span><span class="p">)</span>
        <span class="n">material</span> <span class="o">=</span> <span class="n">blender_mesh</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">materials</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">material</span><span class="o">.</span><span class="n">use_nodes</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Material for &#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39; does not use nodes.&quot;</span><span class="p">)</span>

        <span class="c1"># Access the nodes</span>
        <span class="n">nodes</span> <span class="o">=</span> <span class="n">material</span><span class="o">.</span><span class="n">node_tree</span><span class="o">.</span><span class="n">nodes</span>  <span class="c1"># Access the material&#39;s node tree</span>
        <span class="n">links</span> <span class="o">=</span> <span class="n">material</span><span class="o">.</span><span class="n">node_tree</span><span class="o">.</span><span class="n">links</span>  <span class="c1"># Access node tree links</span>

        <span class="c1"># Add an image texture node</span>
        <span class="k">if</span> <span class="sa">f</span><span class="s1">&#39;[pbSDIC]_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">_imt&#39;</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Image texture node with name [pbSDIC]_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">_imt already exists.&quot;</span><span class="p">)</span>
        
        <span class="n">tex_image_node</span> <span class="o">=</span> <span class="n">nodes</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s2">&quot;ShaderNodeTexImage&quot;</span><span class="p">)</span>
        <span class="n">tex_image_node</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;[pbSDIC]_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">_imt&#39;</span>
        <span class="n">tex_image_node</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">images</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">pattern_path</span><span class="p">)</span>
        <span class="n">tex_image_node</span><span class="o">.</span><span class="n">extension</span> <span class="o">=</span> <span class="s1">&#39;CLIP&#39;</span>  

        <span class="c1"># Get the MixRGB node and connect the image texture node to it</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="sa">f</span><span class="s1">&#39;[pbSDIC]_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">_mbp&#39;</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;MixRGB node with name [pbSDIC]_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">_mbp does not exist.&quot;</span><span class="p">)</span>
        
        <span class="n">mix_node</span> <span class="o">=</span> <span class="n">nodes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;[pbSDIC]_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">_mbp&#39;</span><span class="p">)</span>
        <span class="n">links</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">tex_image_node</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="s1">&#39;Color&#39;</span><span class="p">],</span> <span class="n">mix_node</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="s1">&#39;Color2&#39;</span><span class="p">])</span>

        <span class="c1"># Update the mesh</span>
        <span class="n">blender_mesh</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">update</span><span class="p">()</span></div>



<div class="viewcode-block" id="BlenderExperiment.add_mesh_material">
<a class="viewcode-back" href="../../api_doc/blender_experiment.html#pyblenderSDIC.BlenderExperiment.add_mesh_material">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">add_mesh_material</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">material</span><span class="p">:</span> <span class="n">MaterialBSDF</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add a material to the mesh.</span>

<span class="sd">        The material must be an instance of MaterialBSDF.</span>

<span class="sd">        .. code-block:: python</span>

<span class="sd">            # Example usage</span>
<span class="sd">            experiment = BlenderExperiment(Nb_frames=10)</span>
<span class="sd">            # Define the mesh properties here</span>
<span class="sd">            # ...</span>
<span class="sd">            mesh = meshio.Mesh(points, cells_dict={&quot;triangle&quot;: elements}, point_data={&quot;uvmap&quot;: texture_coordinates})</span>
<span class="sd">            experiment.set_mesh(name=&quot;Mesh1&quot;, mesh=mesh, frames=[True, False, True, False, True, False, True, False, True, False])</span>
<span class="sd">            material = MaterialBSDF()</span>
<span class="sd">            # Define the material properties here</span>
<span class="sd">            # ...</span>
<span class="sd">            experiment.add_mesh_material(name=&quot;Mesh1&quot;, material=material)</span>

<span class="sd">        .. seealso::</span>

<span class="sd">            - :class:`pyblenderSDIC.materials.MaterialBSDF` for more information on how to define a material.</span>

<span class="sd">        .. note::</span>

<span class="sd">            The material is not updated when the mesh is updated.</span>
<span class="sd">            To update the material, you must call this method again with the new material.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        name : str</span>
<span class="sd">            The name of the mesh.</span>
<span class="sd">        </span>
<span class="sd">        material : MaterialBSDF</span>
<span class="sd">            The material object to be added.</span>
<span class="sd">        </span>
<span class="sd">        Raises</span>
<span class="sd">        -------</span>
<span class="sd">        TypeError</span>
<span class="sd">            If name is not a string or material is not an instance of MaterialBSDF.</span>
<span class="sd">        ValueError</span>
<span class="sd">            If a mesh with the same name does not exist in the experiment or in Blender data.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;name must be a string&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">material</span><span class="p">,</span> <span class="n">MaterialBSDF</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;material must be an instance of MaterialBSDF&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mesh_objects</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Mesh with name </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> does not exist.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">objects</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No object with name </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> in Blender data.&quot;</span><span class="p">)</span>
        
        <span class="c1"># Ensure the experiment scene is active</span>
        <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">scene</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_experiment_scene</span>

        <span class="c1"># Get the mesh object</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">blender_mesh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_mesh</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

        <span class="c1"># Access the material</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">blender_mesh</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">materials</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Mesh &#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39; has no material assigned.&quot;</span><span class="p">)</span>
        <span class="n">blender_material</span> <span class="o">=</span> <span class="n">blender_mesh</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">materials</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">blender_material</span><span class="o">.</span><span class="n">use_nodes</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Material for &#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39; does not use nodes.&quot;</span><span class="p">)</span>
        
        <span class="c1"># Access the nodes</span>
        <span class="n">nodes</span> <span class="o">=</span> <span class="n">blender_material</span><span class="o">.</span><span class="n">node_tree</span><span class="o">.</span><span class="n">nodes</span>  <span class="c1"># Access the material&#39;s node tree</span>
        <span class="n">_</span> <span class="o">=</span> <span class="n">blender_material</span><span class="o">.</span><span class="n">node_tree</span><span class="o">.</span><span class="n">links</span>  <span class="c1"># Access node tree links</span>

        <span class="c1"># Access the Principled BSDF node</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="s1">&#39;Principled BSDF&#39;</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No &#39;Principled BSDF&#39; node found in the material. Ensure nodes are enabled.&quot;</span><span class="p">)</span>
        
        <span class="n">principled</span> <span class="o">=</span> <span class="n">blender_material</span><span class="o">.</span><span class="n">node_tree</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Principled BSDF&#39;</span><span class="p">)</span>
        
        <span class="c1"># Access the mix node</span>
        <span class="n">mix_node</span> <span class="o">=</span> <span class="n">blender_material</span><span class="o">.</span><span class="n">node_tree</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;[pbSDIC]_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">_mbp&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">mix_node</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No MixRGB node found for mesh &#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39;. Ensure the mesh has been added with a material.&quot;</span><span class="p">)</span>

        <span class="c1"># Set the properties</span>
        <span class="k">if</span> <span class="n">material</span><span class="o">.</span><span class="n">base_color</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">principled</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;Base Color&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">default_value</span> <span class="o">=</span> <span class="n">material</span><span class="o">.</span><span class="n">base_color</span>
            <span class="n">mix_node</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;Color1&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">default_value</span> <span class="o">=</span> <span class="n">material</span><span class="o">.</span><span class="n">base_color</span>
        <span class="k">if</span> <span class="n">material</span><span class="o">.</span><span class="n">metallic</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">principled</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;Metallic&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">default_value</span> <span class="o">=</span> <span class="n">material</span><span class="o">.</span><span class="n">metallic</span>
        <span class="k">if</span> <span class="n">material</span><span class="o">.</span><span class="n">roughness</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">principled</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;Roughness&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">default_value</span> <span class="o">=</span> <span class="n">material</span><span class="o">.</span><span class="n">roughness</span>
        <span class="k">if</span> <span class="n">material</span><span class="o">.</span><span class="n">IOR</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">principled</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;IOR&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">default_value</span> <span class="o">=</span> <span class="n">material</span><span class="o">.</span><span class="n">IOR</span>
        <span class="k">if</span> <span class="n">material</span><span class="o">.</span><span class="n">alpha</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">principled</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;Alpha&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">default_value</span> <span class="o">=</span> <span class="n">material</span><span class="o">.</span><span class="n">alpha</span>
        <span class="k">if</span> <span class="n">material</span><span class="o">.</span><span class="n">normal</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">principled</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;Normal&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">default_value</span> <span class="o">=</span> <span class="n">material</span><span class="o">.</span><span class="n">normal</span>
        <span class="k">if</span> <span class="n">material</span><span class="o">.</span><span class="n">weight</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">principled</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;Weight&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">default_value</span> <span class="o">=</span> <span class="n">material</span><span class="o">.</span><span class="n">weight</span>
        <span class="k">if</span> <span class="n">material</span><span class="o">.</span><span class="n">subsurface_weight</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">principled</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;Subsurface Weight&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">default_value</span> <span class="o">=</span> <span class="n">material</span><span class="o">.</span><span class="n">subsurface_weight</span>
        <span class="k">if</span> <span class="n">material</span><span class="o">.</span><span class="n">subsurface_radius</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">principled</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;Subsurface Radius&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">default_value</span> <span class="o">=</span> <span class="n">material</span><span class="o">.</span><span class="n">subsurface_radius</span>
        <span class="k">if</span> <span class="n">material</span><span class="o">.</span><span class="n">subsurface_scale</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">principled</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;Subsurface Scale&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">default_value</span> <span class="o">=</span> <span class="n">material</span><span class="o">.</span><span class="n">subsurface_scale</span>
        <span class="k">if</span> <span class="n">material</span><span class="o">.</span><span class="n">subsurface_IOR</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">principled</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;Subsurface IOR&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">default_value</span> <span class="o">=</span> <span class="n">material</span><span class="o">.</span><span class="n">subsurface_IOR</span>
        <span class="k">if</span> <span class="n">material</span><span class="o">.</span><span class="n">subsurface_anisotropy</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">principled</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;Subsurface Anisotropy&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">default_value</span> <span class="o">=</span> <span class="n">material</span><span class="o">.</span><span class="n">subsurface_anisotropy</span>
        <span class="k">if</span> <span class="n">material</span><span class="o">.</span><span class="n">specular_IOR_level</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">principled</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;Specular IOR Level&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">default_value</span> <span class="o">=</span> <span class="n">material</span><span class="o">.</span><span class="n">specular_IOR_level</span>
        <span class="k">if</span> <span class="n">material</span><span class="o">.</span><span class="n">specular_tint</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">principled</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;Specular Tint&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">default_value</span> <span class="o">=</span> <span class="n">material</span><span class="o">.</span><span class="n">specular_tint</span>
        <span class="k">if</span> <span class="n">material</span><span class="o">.</span><span class="n">anisotropic</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">principled</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;Anisotropic&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">default_value</span> <span class="o">=</span> <span class="n">material</span><span class="o">.</span><span class="n">anisotropic</span>
        <span class="k">if</span> <span class="n">material</span><span class="o">.</span><span class="n">anisotropic_rotation</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">principled</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;Anisotropic Rotation&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">default_value</span> <span class="o">=</span> <span class="n">material</span><span class="o">.</span><span class="n">anisotropic_rotation</span>
        <span class="k">if</span> <span class="n">material</span><span class="o">.</span><span class="n">tangent</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">principled</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;Tangent&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">default_value</span> <span class="o">=</span> <span class="n">material</span><span class="o">.</span><span class="n">tangent</span>
        <span class="k">if</span> <span class="n">material</span><span class="o">.</span><span class="n">transmission_weight</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">principled</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;Transmission Weight&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">default_value</span> <span class="o">=</span> <span class="n">material</span><span class="o">.</span><span class="n">transmission_weight</span>
        <span class="k">if</span> <span class="n">material</span><span class="o">.</span><span class="n">coat_weight</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">principled</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;Coat Weight&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">default_value</span> <span class="o">=</span> <span class="n">material</span><span class="o">.</span><span class="n">coat_weight</span>
        <span class="k">if</span> <span class="n">material</span><span class="o">.</span><span class="n">coat_roughness</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">principled</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;Coat Roughness&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">default_value</span> <span class="o">=</span> <span class="n">material</span><span class="o">.</span><span class="n">coat_roughness</span>
        <span class="k">if</span> <span class="n">material</span><span class="o">.</span><span class="n">coat_IOR</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">principled</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;Coat IOR&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">default_value</span> <span class="o">=</span> <span class="n">material</span><span class="o">.</span><span class="n">coat_IOR</span>
        <span class="k">if</span> <span class="n">material</span><span class="o">.</span><span class="n">coat_tint</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">principled</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;Coat Tint&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">default_value</span> <span class="o">=</span> <span class="n">material</span><span class="o">.</span><span class="n">coat_tint</span>
        <span class="k">if</span> <span class="n">material</span><span class="o">.</span><span class="n">coat_normal</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">principled</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;Coat Normal&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">default_value</span> <span class="o">=</span> <span class="n">material</span><span class="o">.</span><span class="n">coat_normal</span>
        <span class="k">if</span> <span class="n">material</span><span class="o">.</span><span class="n">sheen_weight</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">principled</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;Sheen Weight&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">default_value</span> <span class="o">=</span> <span class="n">material</span><span class="o">.</span><span class="n">sheen_weight</span>
        <span class="k">if</span> <span class="n">material</span><span class="o">.</span><span class="n">sheen_roughness</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">principled</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;Sheen Roughness&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">default_value</span> <span class="o">=</span> <span class="n">material</span><span class="o">.</span><span class="n">sheen_roughness</span>
        <span class="k">if</span> <span class="n">material</span><span class="o">.</span><span class="n">sheen_tint</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">principled</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;Sheen Tint&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">default_value</span> <span class="o">=</span> <span class="n">material</span><span class="o">.</span><span class="n">sheen_tint</span>
        <span class="k">if</span> <span class="n">material</span><span class="o">.</span><span class="n">emission_color</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">principled</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;Emission Color&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">default_value</span> <span class="o">=</span> <span class="n">material</span><span class="o">.</span><span class="n">emission_color</span>
        <span class="k">if</span> <span class="n">material</span><span class="o">.</span><span class="n">emission_strength</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">principled</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;Emission Strength&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">default_value</span> <span class="o">=</span> <span class="n">material</span><span class="o">.</span><span class="n">emission_strength</span>
        <span class="k">if</span> <span class="n">material</span><span class="o">.</span><span class="n">thin_film_thickness</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">principled</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;Thin Film Thickness&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">default_value</span> <span class="o">=</span> <span class="n">material</span><span class="o">.</span><span class="n">thin_film_thickness</span>
        <span class="k">if</span> <span class="n">material</span><span class="o">.</span><span class="n">thin_film_IOR</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">principled</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;Thin Film IOR&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">default_value</span> <span class="o">=</span> <span class="n">material</span><span class="o">.</span><span class="n">thin_film_IOR</span>

        <span class="c1"># Update the mesh</span>
        <span class="n">blender_mesh</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">update</span><span class="p">()</span></div>



<div class="viewcode-block" id="BlenderExperiment.set_mesh_frames">
<a class="viewcode-back" href="../../api_doc/blender_experiment.html#pyblenderSDIC.BlenderExperiment.set_mesh_frames">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">set_mesh_frames</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">frames</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">bool</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the frames for which the mesh will be active.</span>
<span class="sd">        If None, the mesh will be active for all frames.</span>
<span class="sd">        Else a list of booleans must be provided, where each boolean indicates if the mesh is active for that frame.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        name : str</span>
<span class="sd">            The name of the mesh.</span>
<span class="sd">        </span>
<span class="sd">        frames : List[bool], optional</span>
<span class="sd">            A list of booleans indicating which frames the mesh will be active.</span>
<span class="sd">            If None, the mesh will be active for all frames (default is None).</span>

<span class="sd">        Raises</span>
<span class="sd">        -------</span>
<span class="sd">        TypeError</span>
<span class="sd">            If name is not a string or frames is not a list of booleans.</span>
<span class="sd">        ValueError</span>
<span class="sd">            If a mesh with the same name does not exist in the experiment or in Blender data.</span>
<span class="sd">            If the length of frames is not equal to the number of frames in the experiment (end_frame).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;name must be a string&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mesh_objects</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Mesh with name </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> does not exist.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">objects</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No object with name </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> in Blender data.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">frames</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">frames</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;frames must be a list of booleans&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">frames</span><span class="p">)</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_end_frame</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Length of frames must be equal to </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_end_frame</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">frame</span> <span class="ow">in</span> <span class="n">frames</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;frames must be a list of booleans&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">frames</span> <span class="o">=</span> <span class="p">[</span><span class="kc">True</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_end_frame</span>
        
        <span class="c1"># Ensure the experiment scene is active</span>
        <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">scene</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_experiment_scene</span>

        <span class="c1"># Get the mesh object</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">blender_mesh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_mesh</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

        <span class="c1"># Set the visibility of the mesh for each frame</span>
        <span class="k">for</span> <span class="n">frame</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_end_frame</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">blender_mesh</span><span class="o">.</span><span class="n">hide_render</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">frames</span><span class="p">[</span><span class="n">frame</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
            <span class="n">blender_mesh</span><span class="o">.</span><span class="n">keyframe_insert</span><span class="p">(</span><span class="n">data_path</span><span class="o">=</span><span class="s2">&quot;hide_render&quot;</span><span class="p">,</span> <span class="n">frame</span><span class="o">=</span><span class="n">frame</span><span class="p">)</span>

        <span class="c1"># Apply the changes to the mesh</span>
        <span class="n">blender_mesh</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>

        <span class="c1"># Set the frames for which the mesh will be active</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mesh_objects</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">frames</span></div>


    
<div class="viewcode-block" id="BlenderExperiment.get_mesh_frames">
<a class="viewcode-back" href="../../api_doc/blender_experiment.html#pyblenderSDIC.BlenderExperiment.get_mesh_frames">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_mesh_frames</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">bool</span><span class="p">]:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the frames for which the mesh is active.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        name : str</span>
<span class="sd">            The name of the mesh.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        List[bool]</span>
<span class="sd">            A list of booleans indicating which frames the mesh is active.</span>
<span class="sd">        </span>
<span class="sd">        Raises</span>
<span class="sd">        -------</span>
<span class="sd">        TypeError</span>
<span class="sd">            If name is not a string.</span>
<span class="sd">        ValueError</span>
<span class="sd">            If a mesh with the same name does not exist in the experiment or in Blender data.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;name must be a string&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mesh_objects</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Mesh with name </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> does not exist.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">objects</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No object with name </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> in Blender data.&quot;</span><span class="p">)</span>
        
        <span class="c1"># Ensure the experiment scene is active</span>
        <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">scene</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_experiment_scene</span>

        <span class="c1"># Get the frames for which the mesh is active</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mesh_objects</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span></div>

    

<div class="viewcode-block" id="BlenderExperiment.get_mesh">
<a class="viewcode-back" href="../../api_doc/blender_experiment.html#pyblenderSDIC.BlenderExperiment.get_mesh">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_mesh</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">meshio</span><span class="o">.</span><span class="n">Mesh</span><span class="p">,</span> <span class="n">Object</span><span class="p">]:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the mesh object and its Blender object.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        name : str</span>
<span class="sd">            The name of the mesh to retrieve.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Tuple[meshio.Mesh, Object]</span>
<span class="sd">            A tuple containing the meshio.Mesh object and its corresponding Blender object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;name must be a string&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mesh_objects</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Mesh with name </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> does not exist.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">objects</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No object with name </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> in Blender data.&quot;</span><span class="p">)</span>
        
        <span class="c1"># Ensure the experiment scene is active</span>
        <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">scene</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_experiment_scene</span>

        <span class="c1"># Get the mesh object</span>
        <span class="n">mesh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mesh_objects</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">blender_mesh</span> <span class="o">=</span> <span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">objects</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>

        <span class="c1"># Check the types of the objects</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">meshio</span><span class="o">.</span><span class="n">Mesh</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;[ERROR] mesh must be an instance of meshio.Mesh&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">blender_mesh</span><span class="p">,</span> <span class="n">Object</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;[ERROR] blender_mesh must be an instance of Object&quot;</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">mesh</span><span class="p">,</span> <span class="n">blender_mesh</span></div>

    

<div class="viewcode-block" id="BlenderExperiment.get_mesh_names">
<a class="viewcode-back" href="../../api_doc/blender_experiment.html#pyblenderSDIC.BlenderExperiment.get_mesh_names">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_mesh_names</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the names of all meshes in the experiment.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        List[str]</span>
<span class="sd">            A list of mesh names.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_mesh_objects</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span></div>



<div class="viewcode-block" id="BlenderExperiment.remove_mesh">
<a class="viewcode-back" href="../../api_doc/blender_experiment.html#pyblenderSDIC.BlenderExperiment.remove_mesh">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">remove_mesh</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Remove a mesh from the experiment.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        name : str</span>
<span class="sd">            The name of the mesh to remove.</span>

<span class="sd">        Raises</span>
<span class="sd">        -------</span>
<span class="sd">        TypeError</span>
<span class="sd">            If name is not a string.</span>
<span class="sd">        ValueError</span>
<span class="sd">            If a mesh with the same name does not exist in the experiment or in Blender data.</span>

<span class="sd">        Blender Details</span>
<span class="sd">        ---------------</span>
<span class="sd">        When removing a mesh, the following actions are performed:</span>

<span class="sd">        - The mesh ``{name}`` is removed from the Blender scene.</span>
<span class="sd">        - The material ``[pbSDIC]_{name}_mat`` is removed from the Blender data.</span>
<span class="sd">        - The MixRGB node ``[pbSDIC]_{name}_mbp`` is removed from the material node tree.</span>
<span class="sd">        - The uv_layer ``[pbSDIC]_{name}_uvm`` is removed from the mesh data.</span>
<span class="sd">        - The node texture ``[pbSDIC]_{name}_imt`` is removed from the material node tree.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;name must be a string&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mesh_objects</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Mesh with name </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> does not exist.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">objects</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No object with name </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> in Blender data.&quot;</span><span class="p">)</span>
        
        <span class="c1"># Ensure the experiment scene is active</span>
        <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">scene</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_experiment_scene</span>

        <span class="c1"># Remove the mesh from the scene</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">blender_mesh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_mesh</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

        <span class="c1"># Access the material</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">blender_mesh</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">materials</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Mesh &#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39; has no material assigned.&quot;</span><span class="p">)</span>
        <span class="n">material</span> <span class="o">=</span> <span class="n">blender_mesh</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">materials</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">material</span><span class="o">.</span><span class="n">use_nodes</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Material for &#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39; does not use nodes.&quot;</span><span class="p">)</span>
        
        <span class="c1"># Access the nodes of the material</span>
        <span class="n">nodes</span> <span class="o">=</span> <span class="n">material</span><span class="o">.</span><span class="n">node_tree</span><span class="o">.</span><span class="n">nodes</span>  <span class="c1"># Access the material&#39;s node tree</span>
        <span class="n">_</span> <span class="o">=</span> <span class="n">material</span><span class="o">.</span><span class="n">node_tree</span><span class="o">.</span><span class="n">links</span>  <span class="c1"># Access node tree links</span>

        <span class="c1"># Remove the MixRGB node</span>
        <span class="k">if</span> <span class="sa">f</span><span class="s1">&#39;[pbSDIC]_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">_mbp&#39;</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">:</span>
            <span class="n">mix_node</span> <span class="o">=</span> <span class="n">nodes</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;[pbSDIC]_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">_mbp&#39;</span><span class="p">]</span>
            <span class="n">nodes</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">mix_node</span><span class="p">)</span>

        <span class="c1"># Remove the material</span>
        <span class="n">blender_mesh</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">materials</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">materials</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">material</span><span class="p">)</span>

        <span class="c1"># Remove the uv_layer</span>
        <span class="k">if</span> <span class="sa">f</span><span class="s1">&#39;[pbSDIC]_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">_uvm&#39;</span> <span class="ow">in</span> <span class="n">blender_mesh</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">uv_layers</span><span class="p">:</span>
            <span class="n">uv_layer</span> <span class="o">=</span> <span class="n">blender_mesh</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">uv_layers</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;[pbSDIC]_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">_uvm&#39;</span><span class="p">]</span>
            <span class="n">blender_mesh</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">uv_layers</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">uv_layer</span><span class="p">)</span>

        <span class="c1"># Remove the image texture node</span>
        <span class="k">if</span> <span class="sa">f</span><span class="s1">&#39;[pbSDIC]_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">_imt&#39;</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">:</span>
            <span class="n">tex_image_node</span> <span class="o">=</span> <span class="n">nodes</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;[pbSDIC]_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">_imt&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">tex_image_node</span><span class="o">.</span><span class="n">image</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">images</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">tex_image_node</span><span class="o">.</span><span class="n">image</span><span class="p">)</span>
            <span class="n">nodes</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">tex_image_node</span><span class="p">)</span>

        <span class="c1"># Remove the mesh from the scene</span>
        <span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">blender_mesh</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mesh_objects</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">name</span><span class="p">)</span></div>


    
<div class="viewcode-block" id="BlenderExperiment.update_mesh">
<a class="viewcode-back" href="../../api_doc/blender_experiment.html#pyblenderSDIC.BlenderExperiment.update_mesh">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">update_mesh</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update the mesh properties in the Blender scene.</span>
<span class="sd">        This method must be called after updating the mesh properties in the meshio.Mesh object.</span>

<span class="sd">        .. code-block:: python</span>

<span class="sd">            # Example usage</span>
<span class="sd">            experiment = BlenderExperiment(Nb_frames=10)</span>
<span class="sd">            # Define the mesh properties here</span>
<span class="sd">            # ...</span>
<span class="sd">            mesh = meshio.Mesh(points, cells_dict={&quot;triangle&quot;: elements}, point_data={&quot;uvmap&quot;: texture_coordinates})</span>
<span class="sd">            experiment.add_mesh(name=&quot;Mesh1&quot;, mesh=mesh, frames=[True, False, True, False, True, False, True, False, True, False])</span>
<span class="sd">            # Update some nodes of the mesh here</span>
<span class="sd">            # ...</span>
<span class="sd">            experiment.update_mesh(name=&quot;Mesh1&quot;) # To set active the modifications in the Blender scene</span>

<span class="sd">        .. note::</span>

<span class="sd">            If a pattern is setted to the mesh, the uvmap are also updated.</span>

<span class="sd">        .. warning::</span>

<span class="sd">            The number of nodes must be unchanged !!!</span>

<span class="sd">            Furthermore, this method does not update the material properties of the mesh and the pattern image: </span>
<span class="sd">            </span>
<span class="sd">            - To update the material properties, use the :meth:`pyblenderSDIC.BlenderExperiment.add_mesh_material` method again.</span>
<span class="sd">            - To change the pattern image, use the :meth:`pyblenderSDIC.BlenderExperiment.change_mesh_pattern` method.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        name : str</span>
<span class="sd">            The name of the mesh to update.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;name must be a string&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mesh_objects</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Mesh with name </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> does not exist.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">objects</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No object with name </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> in Blender data.&quot;</span><span class="p">)</span>
        
        <span class="c1"># Ensure the experiment scene is active</span>
        <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">scene</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_experiment_scene</span>

        <span class="c1"># Get the mesh object</span>
        <span class="n">mesh</span><span class="p">,</span> <span class="n">blender_mesh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_mesh</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

        <span class="c1"># Extract the vertices and faces from the mesh</span>
        <span class="n">points</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">points</span>
        <span class="n">cells</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">cells_dict</span><span class="p">[</span><span class="s2">&quot;triangle&quot;</span><span class="p">]</span>
        <span class="n">uvmap</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">point_data</span><span class="p">[</span><span class="s2">&quot;uvmap&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="n">mesh</span><span class="o">.</span><span class="n">point_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="s2">&quot;uvmap&quot;</span> <span class="ow">in</span> <span class="n">mesh</span><span class="o">.</span><span class="n">point_data</span> <span class="k">else</span> <span class="kc">None</span>

        <span class="c1"># Apply the vertices and faces to the Blender mesh</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">vertex</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">blender_mesh</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">vertices</span><span class="p">):</span>
            <span class="n">vertex</span><span class="o">.</span><span class="n">co</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">points</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
            <span class="n">vertex</span><span class="o">.</span><span class="n">co</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">points</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
            <span class="n">vertex</span><span class="o">.</span><span class="n">co</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span> <span class="n">points</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">poly</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">blender_mesh</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">polygons</span><span class="p">):</span>
            <span class="n">poly</span><span class="o">.</span><span class="n">vertices</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">vertex</span><span class="p">)</span> <span class="k">for</span> <span class="n">vertex</span> <span class="ow">in</span> <span class="n">cells</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>

        <span class="c1"># Update the uvmap if it exists</span>
        <span class="k">if</span> <span class="sa">f</span><span class="s1">&#39;[pbSDIC]_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">_uvm&#39;</span> <span class="ow">in</span> <span class="n">blender_mesh</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">uv_layers</span><span class="p">:</span>
            <span class="n">uv_layer</span> <span class="o">=</span> <span class="n">blender_mesh</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">uv_layers</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;[pbSDIC]_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">_uvm&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">uvmap</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">loop</span> <span class="ow">in</span> <span class="n">blender_mesh</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">loops</span><span class="p">:</span>
                    <span class="n">uv_layer</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">loop</span><span class="o">.</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">uv</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">uvmap</span><span class="p">[</span><span class="n">loop</span><span class="o">.</span><span class="n">vertex_index</span><span class="p">,</span> <span class="p">:</span><span class="mi">2</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Mesh </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> does not have a UVMAP defined but the uv_layer exists.&quot;</span><span class="p">)</span>

        <span class="c1"># Update the mesh</span>
        <span class="n">blender_mesh</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">update</span><span class="p">()</span></div>



<div class="viewcode-block" id="BlenderExperiment.change_mesh_pattern">
<a class="viewcode-back" href="../../api_doc/blender_experiment.html#pyblenderSDIC.BlenderExperiment.change_mesh_pattern">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">change_mesh_pattern</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">pattern_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Change the pattern of the mesh material.</span>

<span class="sd">        The pattern must be a valid image file path (e.g., PNG, JPEG).</span>
<span class="sd">        The pattern will be applied to the mesh material as a texture.</span>

<span class="sd">        .. code-block:: python</span>

<span class="sd">            # Example usage</span>
<span class="sd">            experiment = BlenderExperiment(Nb_frames=10)</span>
<span class="sd">            # Define the mesh properties here</span>
<span class="sd">            # ...</span>
<span class="sd">            mesh = meshio.Mesh(points, cells_dict={&quot;triangle&quot;: elements}, point_data={&quot;uvmap&quot;: texture_coordinates})</span>
<span class="sd">            experiment.add_mesh(name=&quot;Mesh1&quot;, mesh=mesh, frames=[True, False, True, False, True, False, True, False, True, False])</span>
<span class="sd">            experiment.add_mesh_pattern(name=&quot;Mesh1&quot;, pattern_path=&quot;path/to/pattern.png&quot;)</span>
<span class="sd">            experiment.change_mesh_pattern(name=&quot;Mesh1&quot;, pattern_path=&quot;path/to/new_pattern.png&quot;)</span>

<span class="sd">        .. seealso::</span>

<span class="sd">            - :class:`pyblenderSDIC.BlenderExperiment.add_mesh_pattern` for more information on how to add a pattern.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        name : str</span>
<span class="sd">            The name of the mesh.</span>
<span class="sd">        </span>
<span class="sd">        pattern_path : str</span>
<span class="sd">            The path to the new pattern image file.</span>
<span class="sd">        </span>
<span class="sd">        Raises</span>
<span class="sd">        -------</span>
<span class="sd">        TypeError</span>
<span class="sd">            If name is not a string or pattern_path is not a string.</span>
<span class="sd">        ValueError</span>
<span class="sd">            If a mesh with the same name does not exist in the experiment or in Blender data.</span>
<span class="sd">            If the pattern path is not valid or the image format is not supported.</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;name must be a string&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pattern_path</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;pattern_path must be a string&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mesh_objects</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Mesh with name </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> does not exist.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">objects</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No object with name </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> in Blender data.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">pattern_path</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Pattern path </span><span class="si">{</span><span class="n">pattern_path</span><span class="si">}</span><span class="s2"> is not valid.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">pattern_path</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">endswith</span><span class="p">((</span><span class="s1">&#39;.png&#39;</span><span class="p">,</span> <span class="s1">&#39;.jpg&#39;</span><span class="p">,</span> <span class="s1">&#39;.jpeg&#39;</span><span class="p">,</span> <span class="s1">&#39;.bmp&#39;</span><span class="p">,</span> <span class="s1">&#39;.tiff&#39;</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Pattern path </span><span class="si">{</span><span class="n">pattern_path</span><span class="si">}</span><span class="s2"> is not a valid image format.&quot;</span><span class="p">)</span>
        
        <span class="c1"># Ensure the experiment scene is active</span>
        <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">scene</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_experiment_scene</span>

        <span class="c1"># Get the mesh object</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">blender_mesh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_mesh</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

        <span class="c1"># Access the material</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">blender_mesh</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">materials</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Mesh &#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39; has no material assigned.&quot;</span><span class="p">)</span>
        <span class="n">material</span> <span class="o">=</span> <span class="n">blender_mesh</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">materials</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">material</span><span class="o">.</span><span class="n">use_nodes</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Material for &#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39; does not use nodes.&quot;</span><span class="p">)</span>

        <span class="c1"># Access the nodes</span>
        <span class="n">nodes</span> <span class="o">=</span> <span class="n">material</span><span class="o">.</span><span class="n">node_tree</span><span class="o">.</span><span class="n">nodes</span>  <span class="c1"># Access the material&#39;s node tree</span>
        <span class="n">_</span> <span class="o">=</span> <span class="n">material</span><span class="o">.</span><span class="n">node_tree</span><span class="o">.</span><span class="n">links</span>  <span class="c1"># Access node tree links</span>

        <span class="c1"># Add an image texture node</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="sa">f</span><span class="s1">&#39;[pbSDIC]_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">_imt&#39;</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Image texture node with name [pbSDIC]_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">_imt does not exist.&quot;</span><span class="p">)</span>
        
        <span class="n">tex_image_node</span> <span class="o">=</span> <span class="n">nodes</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;[pbSDIC]_</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">_imt&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">tex_image_node</span><span class="o">.</span><span class="n">image</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">images</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">tex_image_node</span><span class="o">.</span><span class="n">image</span><span class="p">)</span>
        <span class="n">tex_image_node</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">images</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">pattern_path</span><span class="p">)</span>
        <span class="n">tex_image_node</span><span class="o">.</span><span class="n">extension</span> <span class="o">=</span> <span class="s1">&#39;CLIP&#39;</span>  <span class="c1"># Set the extension to CLIP to avoid stretching the image</span>
        <span class="n">tex_image_node</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">reload</span><span class="p">()</span>  <span class="c1"># Reload the image to apply the changes</span>

        <span class="c1"># Update the mesh</span>
        <span class="n">blender_mesh</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">update</span><span class="p">()</span></div>

   
    

    <span class="c1"># =======================================================</span>
    <span class="c1"># Blender Scene Management (SPOTLIGHT)</span>
    <span class="c1"># =======================================================</span>
<div class="viewcode-block" id="BlenderExperiment.add_spotlight">
<a class="viewcode-back" href="../../api_doc/blender_experiment.html#pyblenderSDIC.BlenderExperiment.add_spotlight">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">add_spotlight</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">spotlight</span><span class="p">:</span> <span class="n">SpotLight</span><span class="p">,</span> <span class="n">frames</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">bool</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add a spotlight to the experiment.</span>

<span class="sd">        The spotlight must be an instance of SpotLight.</span>

<span class="sd">        .. note::</span>

<span class="sd">            The name of the light must be unique in the experiment and in Blender data.</span>
<span class="sd">            Furthemore, because Blender limits the name of the objects to 63 characters and ``pyblenderSDIC`` add prefixe for sub-dependant object of the light,</span>
<span class="sd">            the name of the light must be less than 50 characters.</span>

<span class="sd">        .. code-block:: python</span>

<span class="sd">            # Example usage</span>
<span class="sd">            experiment = BlenderExperiment(Nb_frames=10)</span>
<span class="sd">            spotlight = SpotLight()</span>
<span class="sd">            # Define the SpotLight properties here</span>
<span class="sd">            # ...</span>
<span class="sd">            experiment.add_spotlight(name=&quot;Spotlight1&quot;, spotlight=SpotLight, frames=[True, False, True, False, True, False, True, False, True, False])</span>

<span class="sd">        .. seealso::</span>

<span class="sd">            - :class:`pyblenderSDIC.SpotLight` for more information on how to define a spotlight.     </span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        name : str</span>
<span class="sd">            The name of the spotlight with less than 50 characters.</span>
<span class="sd">        </span>
<span class="sd">        spotlight : SpotLight</span>
<span class="sd">            The spotlight object to be added.</span>
<span class="sd">        </span>
<span class="sd">        frames : List[bool], optional</span>
<span class="sd">            A list of booleans indicating which frames the spotlight will be active.</span>
<span class="sd">            If None, the spotlight will be active for all frames (default is None).</span>

<span class="sd">        Raises</span>
<span class="sd">        -------</span>
<span class="sd">        TypeError</span>
<span class="sd">            If name is not a string or spotlight is not an instance of SpotLight.</span>
<span class="sd">        ValueError</span>
<span class="sd">            If a spotlight with the same name already exists in the experiment or in Blender data.</span>
<span class="sd">            If the length of frames is not equal to the number of frames in the experiment (end_frame).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;name must be a string&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">50</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;name must be less than 50 characters&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_spotlight_objects</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Spotlight with name </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> already exists.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">objects</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Object with name </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> already exists in Blender data.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">spotlight</span><span class="p">,</span> <span class="n">SpotLight</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;spotlight must be an instance of Spotlight&quot;</span><span class="p">)</span>

        <span class="c1"># Ensure the experiment scene is active</span>
        <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">scene</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_experiment_scene</span>

        <span class="c1"># Ensure the experiment scene is active</span>
        <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">scene</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_experiment_scene</span>

        <span class="c1"># Create the spotlight</span>
        <span class="n">spotlight_data</span> <span class="o">=</span> <span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">lights</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;SPOT&#39;</span><span class="p">)</span>
        <span class="n">blender_spotlight</span> <span class="o">=</span> <span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">spotlight_data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_spotlight_objects</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">spotlight</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>

        <span class="c1"># Set the frames for which the mesh will be active</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_spotlight_frames</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">frames</span><span class="p">)</span>

        <span class="c1"># Link the spotlight to the scene</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_experiment_scene</span><span class="o">.</span><span class="n">collection</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">link</span><span class="p">(</span><span class="n">blender_spotlight</span><span class="p">)</span>

        <span class="c1"># Set the spotlight properties</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_spotlight</span><span class="p">(</span><span class="n">name</span><span class="p">)</span></div>


    
<div class="viewcode-block" id="BlenderExperiment.set_spotlight_frames">
<a class="viewcode-back" href="../../api_doc/blender_experiment.html#pyblenderSDIC.BlenderExperiment.set_spotlight_frames">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">set_spotlight_frames</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">frames</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">bool</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the frames for which the spotlight will be active.</span>
<span class="sd">        If None, the spotlight will be active for all frames.</span>
<span class="sd">        Else a list of booleans must be provided, where each boolean indicates if the spotlight is active for that frame.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        name : str</span>
<span class="sd">            The name of the spotlight.</span>
<span class="sd">        </span>
<span class="sd">        frames : List[bool], optional</span>
<span class="sd">            A list of booleans indicating which frames the spotlight will be active.</span>
<span class="sd">            If None, the spotlight will be active for all frames (default is None).</span>

<span class="sd">        Raises</span>
<span class="sd">        -------</span>
<span class="sd">        TypeError</span>
<span class="sd">            If name is not a string or frames is not a list of booleans.</span>
<span class="sd">        ValueError</span>
<span class="sd">            If a spotlight with the same name does not exist in the experiment or in Blender data.</span>
<span class="sd">            If the length of frames is not equal to the number of frames in the experiment (end_frame).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;name must be a string&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_spotlight_objects</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Spotlight with name </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> does not exist.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">objects</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No object with name </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> in Blender data.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">frames</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">frames</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;frames must be a list of booleans&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">frames</span><span class="p">)</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_end_frame</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Length of frames must be equal to </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_end_frame</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">frame</span> <span class="ow">in</span> <span class="n">frames</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;frames must be a list of booleans&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">frames</span> <span class="o">=</span> <span class="p">[</span><span class="kc">True</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_end_frame</span>
        
        <span class="c1"># Ensure the experiment scene is active</span>
        <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">scene</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_experiment_scene</span>

        <span class="c1"># Get the spotlight object</span>
        <span class="n">spotlight</span><span class="p">,</span> <span class="n">blender_spotlight</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_spotlight</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

        <span class="c1"># Set the visibility of the spotlight for each frame</span>
        <span class="k">for</span> <span class="n">frame</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_end_frame</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">blender_spotlight</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">energy</span> <span class="o">=</span> <span class="n">spotlight</span><span class="o">.</span><span class="n">energy</span> <span class="k">if</span> <span class="n">frames</span><span class="p">[</span><span class="n">frame</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="k">else</span> <span class="mi">0</span>
            <span class="n">blender_spotlight</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">keyframe_insert</span><span class="p">(</span><span class="n">data_path</span><span class="o">=</span><span class="s2">&quot;energy&quot;</span><span class="p">,</span> <span class="n">frame</span><span class="o">=</span><span class="n">frame</span><span class="p">)</span>

        <span class="c1"># Set the frames for which the mesh will be active</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_spotlight_objects</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">frames</span></div>


    
<div class="viewcode-block" id="BlenderExperiment.get_spotlight_frames">
<a class="viewcode-back" href="../../api_doc/blender_experiment.html#pyblenderSDIC.BlenderExperiment.get_spotlight_frames">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_spotlight_frames</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">bool</span><span class="p">]:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the frames for which the spotlight is active.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        name : str</span>
<span class="sd">            The name of the spotlight.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        List[bool]</span>
<span class="sd">            A list of booleans indicating which frames the spotlight is active.</span>
<span class="sd">        </span>
<span class="sd">        Raises</span>
<span class="sd">        -------</span>
<span class="sd">        TypeError</span>
<span class="sd">            If name is not a string.</span>
<span class="sd">        ValueError</span>
<span class="sd">            If a spotlight with the same name does not exist in the experiment or in Blender data.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;name must be a string&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_spotlight_objects</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Spotlight with name </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> does not exist.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">objects</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No object with name </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> in Blender data.&quot;</span><span class="p">)</span>
        
        <span class="c1"># Ensure the experiment scene is active</span>
        <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">scene</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_experiment_scene</span>

        <span class="c1"># Get the frames for which the spotlight is active</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_spotlight_objects</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span></div>

    

<div class="viewcode-block" id="BlenderExperiment.get_spotlight">
<a class="viewcode-back" href="../../api_doc/blender_experiment.html#pyblenderSDIC.BlenderExperiment.get_spotlight">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_spotlight</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">SpotLight</span><span class="p">,</span> <span class="n">Object</span><span class="p">]:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the spotlight object and its Blender object.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        name : str</span>
<span class="sd">            The name of the spotlight to retrieve.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Tuple[SpotLight, Object]</span>
<span class="sd">            A tuple containing the SpotLight object and its corresponding Blender object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;name must be a string&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_spotlight_objects</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Spotlight with name </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> does not exist.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">objects</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No object with name </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> in Blender data.&quot;</span><span class="p">)</span>
        
        <span class="c1"># Ensure the experiment scene is active</span>
        <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">scene</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_experiment_scene</span>

        <span class="c1"># Get the spotlight object</span>
        <span class="n">spotlight</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_spotlight_objects</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">blender_spotlight</span> <span class="o">=</span> <span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">objects</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>

        <span class="c1"># Check the types of the objects</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">spotlight</span><span class="p">,</span> <span class="n">SpotLight</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;[ERROR] spotlight must be an instance of SpotLight&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">blender_spotlight</span><span class="p">,</span> <span class="n">Object</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;[ERROR] blender_spotlight must be an instance of Object&quot;</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">spotlight</span><span class="p">,</span> <span class="n">blender_spotlight</span></div>

    

<div class="viewcode-block" id="BlenderExperiment.remove_spotlight">
<a class="viewcode-back" href="../../api_doc/blender_experiment.html#pyblenderSDIC.BlenderExperiment.remove_spotlight">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">remove_spotlight</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Remove a spotlight from the experiment.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        name : str</span>
<span class="sd">            The name of the spotlight to remove.</span>

<span class="sd">        Raises</span>
<span class="sd">        -------</span>
<span class="sd">        TypeError</span>
<span class="sd">            If name is not a string.</span>
<span class="sd">        ValueError</span>
<span class="sd">            If a spotlight with the same name does not exist in the experiment or in Blender data.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;name must be a string&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_spotlight_objects</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Spotlight with name </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> does not exist.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">objects</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No object with name </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> in Blender data.&quot;</span><span class="p">)</span>
        
        <span class="c1"># Ensure the experiment scene is active</span>
        <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">scene</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_experiment_scene</span>

        <span class="c1"># Remove the spotlight from the scene</span>
        <span class="n">spotlight</span><span class="p">,</span> <span class="n">blender_spotlight</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_spotlight</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">blender_spotlight</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_spotlight_objects</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">name</span><span class="p">)</span></div>


    
<div class="viewcode-block" id="BlenderExperiment.update_spotlight">
<a class="viewcode-back" href="../../api_doc/blender_experiment.html#pyblenderSDIC.BlenderExperiment.update_spotlight">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">update_spotlight</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update the spotlight properties in the Blender scene.</span>
<span class="sd">        This method must be called after updating the spotlight properties in the SpotLight object.</span>

<span class="sd">        .. code-block:: python</span>

<span class="sd">            # Example usage</span>
<span class="sd">            experiment = BlenderExperiment(Nb_frames=10)</span>
<span class="sd">            spotlight = SpotLight()</span>
<span class="sd">            # Define the SpotLight properties here</span>
<span class="sd">            # ...</span>
<span class="sd">            experiment.add_spotlight(name=&quot;Spotlight1&quot;, spotlight=spotlight, frames=[True, False, True, False, True, False, True, False, True, False])</span>
<span class="sd">            # Update some nodes of the spotlight here</span>
<span class="sd">            # ...</span>
<span class="sd">            experiment.update_spotlight(name=&quot;Spotlight1&quot;) # To set active the modifications in the Blender scene</span>
<span class="sd">        </span>
<span class="sd">        .. warning::</span>

<span class="sd">            This method does not update the material properties of the spotlight.</span>
<span class="sd">            Only the position and rotation are updated.  </span>
<span class="sd">            The number of nodes mustnot be changed.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        name : str</span>
<span class="sd">            The name of the spotlight to update.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;name must be a string&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_spotlight_objects</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Spotlight with name </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> does not exist.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">objects</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No object with name </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> in Blender data.&quot;</span><span class="p">)</span>
        
        <span class="c1"># Ensure the experiment scene is active</span>
        <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">scene</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_experiment_scene</span>

        <span class="c1"># Get the spotlight object</span>
        <span class="n">spotlight</span><span class="p">,</span> <span class="n">blender_spotlight</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_spotlight</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

        <span class="c1"># Set the position and rotation of the camera</span>
        <span class="n">rotation</span><span class="p">,</span> <span class="n">translation</span> <span class="o">=</span> <span class="n">spotlight</span><span class="o">.</span><span class="n">get_OpenGL_RT</span><span class="p">()</span>
        <span class="n">blender_spotlight</span><span class="o">.</span><span class="n">location</span> <span class="o">=</span> <span class="n">translation</span>
        <span class="n">blender_quaternion</span> <span class="o">=</span> <span class="n">rotation</span><span class="o">.</span><span class="n">as_quat</span><span class="p">(</span><span class="n">scalar_first</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1"># blender convention [qw, qx, qy, qz]</span>
        <span class="n">blender_spotlight</span><span class="o">.</span><span class="n">rotation_mode</span> <span class="o">=</span> <span class="s1">&#39;QUATERNION&#39;</span>
        <span class="n">blender_spotlight</span><span class="o">.</span><span class="n">rotation_quaternion</span> <span class="o">=</span> <span class="n">blender_quaternion</span>

        <span class="c1"># Set the spotlight properties</span>
        <span class="n">blender_spotlight</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">energy</span> <span class="o">=</span> <span class="n">spotlight</span><span class="o">.</span><span class="n">energy</span>
        <span class="n">blender_spotlight</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">spot_size</span> <span class="o">=</span> <span class="n">spotlight</span><span class="o">.</span><span class="n">spot_size</span>
        <span class="n">blender_spotlight</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">spot_blend</span> <span class="o">=</span> <span class="n">spotlight</span><span class="o">.</span><span class="n">spot_blend</span>

        <span class="c1"># Reset the frames for which the spotlight will be active (in order to have energy = 0 for the frames where the spotlight is not active)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_spotlight_frames</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_spotlight_frames</span><span class="p">(</span><span class="n">name</span><span class="p">))</span></div>




    <span class="c1"># =======================================================</span>
    <span class="c1"># Blender Scene Management (DEFAULT)</span>
    <span class="c1"># =======================================================</span>
<div class="viewcode-block" id="BlenderExperiment.set_default_background">
<a class="viewcode-back" href="../../api_doc/blender_experiment.html#pyblenderSDIC.BlenderExperiment.set_default_background">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">set_default_background</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot; </span>
<span class="sd">        </span>
<span class="sd">        Set the default background for the experiment scene. </span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">bpy</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">world</span><span class="o">.</span><span class="n">new</span><span class="p">()</span>
        <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">world</span> <span class="o">=</span> <span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">worlds</span><span class="p">[</span><span class="s2">&quot;World&quot;</span><span class="p">]</span>
        <span class="n">world_light</span> <span class="o">=</span> <span class="n">bpy</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">worlds</span><span class="p">[</span><span class="s2">&quot;World&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">node_tree</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="s2">&quot;Background&quot;</span><span class="p">]</span>
        <span class="n">world_light</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">default_value</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">world_light</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">default_value</span> <span class="o">=</span> <span class="mf">1.0</span></div>


<div class="viewcode-block" id="BlenderExperiment.update_scene">
<a class="viewcode-back" href="../../api_doc/blender_experiment.html#pyblenderSDIC.BlenderExperiment.update_scene">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">update_scene</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update the Blender scene.</span>
<span class="sd">        This method must be called after adding or modifying any objects in the scene.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Ensure the experiment scene is active</span>
        <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">scene</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_experiment_scene</span>

        <span class="c1"># Update the scene</span>
        <span class="n">bpy</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">ptcache</span><span class="o">.</span><span class="n">free_bake_all</span><span class="p">()</span>
        <span class="n">bpy</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">ptcache</span><span class="o">.</span><span class="n">bake_all</span><span class="p">()</span>       
        <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">view_layer</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
        <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">view_layer</span><span class="o">.</span><span class="n">depsgraph</span><span class="o">.</span><span class="n">update</span><span class="p">()</span></div>


<div class="viewcode-block" id="BlenderExperiment.set_active_frame">
<a class="viewcode-back" href="../../api_doc/blender_experiment.html#pyblenderSDIC.BlenderExperiment.set_active_frame">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">set_active_frame</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frame</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the current frame of the Blender scene.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        frame : int</span>
<span class="sd">            The frame number to set.</span>
<span class="sd">        </span>
<span class="sd">        Raises</span>
<span class="sd">        -------</span>
<span class="sd">        TypeError</span>
<span class="sd">            If frame is not an integer.</span>
<span class="sd">        ValueError</span>
<span class="sd">            If frame is out of range.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="n">Integral</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;frame must be an integer&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">frame</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">frame</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_end_frame</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;frame must be between 1 and </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_end_frame</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        
        <span class="c1"># Ensure the experiment scene is active</span>
        <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">scene</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_experiment_scene</span>

        <span class="c1"># Set the current frame</span>
        <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">frame_set</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">frame</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_active_frame</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span></div>




    <span class="c1"># =======================================================</span>
    <span class="c1"># Blender Scene RENDER</span>
    <span class="c1"># =======================================================</span>
<div class="viewcode-block" id="BlenderExperiment.render">
<a class="viewcode-back" href="../../api_doc/blender_experiment.html#pyblenderSDIC.BlenderExperiment.render">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">render</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">output_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">output_format</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;TIFF&quot;</span><span class="p">,</span>
        <span class="n">color_mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;BW&quot;</span><span class="p">,</span>
        <span class="n">color_depth</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;8&quot;</span><span class="p">,</span>
        <span class="n">N_samples</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">200</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Render the experiment scene.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        output_path : str</span>
<span class="sd">            The path to save the rendered image.</span>

<span class="sd">        output_format : str, optional</span>
<span class="sd">            The output format of the rendered image (default is &quot;TIFF&quot;).</span>
<span class="sd">        </span>
<span class="sd">        color_mode : str, optional</span>
<span class="sd">            The color mode of the rendered image (default is &quot;BW&quot;).</span>

<span class="sd">        color_depth : str, optional</span>
<span class="sd">            The color depth of the rendered image (default is &quot;8&quot;).</span>
<span class="sd">        </span>
<span class="sd">        N_samples : int, optional</span>
<span class="sd">            The number of samples for rendering (default is 200).</span>

<span class="sd">        Raises</span>
<span class="sd">        -------</span>
<span class="sd">        TypeError</span>
<span class="sd">            If name or output_path is not a string.</span>
<span class="sd">        ValueError</span>
<span class="sd">            If the output format is not supported.</span>
<span class="sd">            If the frame or the camera is not set.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">output_path</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;output_path must be a string&quot;</span><span class="p">)</span>
        
        <span class="c1"># Ensure the experiment scene is active</span>
        <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">scene</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_experiment_scene</span>

        <span class="c1"># Set the current frame and camera</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_active_frame</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No active frame set. Use set_active_frame() to set the current frame.&quot;</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_active_camera</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No active camera set. Use set_active_camera() to set the current camera.&quot;</span><span class="p">)</span>
        
        <span class="n">camera_frames</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_camera_frames</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_active_camera</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">camera_frames</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_active_frame</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Camera </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_active_camera</span><span class="si">}</span><span class="s2"> is not active for frame </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_active_frame</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
    
        <span class="c1"># Set the render settings</span>
        <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">render</span><span class="o">.</span><span class="n">image_settings</span><span class="o">.</span><span class="n">file_format</span> <span class="o">=</span> <span class="n">output_format</span>
        <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">render</span><span class="o">.</span><span class="n">image_settings</span><span class="o">.</span><span class="n">tiff_codec</span> <span class="o">=</span> <span class="s2">&quot;NONE&quot;</span>
        <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">render</span><span class="o">.</span><span class="n">image_settings</span><span class="o">.</span><span class="n">color_mode</span> <span class="o">=</span> <span class="n">color_mode</span>
        <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">render</span><span class="o">.</span><span class="n">image_settings</span><span class="o">.</span><span class="n">color_depth</span> <span class="o">=</span> <span class="n">color_depth</span>
        <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">render</span><span class="o">.</span><span class="n">image_settings</span><span class="o">.</span><span class="n">compression</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">render</span><span class="o">.</span><span class="n">engine</span> <span class="o">=</span> <span class="s1">&#39;CYCLES&#39;</span>
        <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">cycles</span><span class="o">.</span><span class="n">device</span> <span class="o">=</span> <span class="s1">&#39;GPU&#39;</span>
        <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">cycles</span><span class="o">.</span><span class="n">samples</span> <span class="o">=</span> <span class="n">N_samples</span>
        <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">cycles</span><span class="o">.</span><span class="n">use_denoising</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">bpy</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">render</span><span class="o">.</span><span class="n">filepath</span> <span class="o">=</span> <span class="n">output_path</span>

        <span class="c1"># Perform the rendering</span>
        <span class="n">bpy</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">render</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">write_still</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Rendered image saved to </span><span class="si">{</span><span class="n">output_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>
</div>

</pre></div>

                </article>
              
              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
      © Copyright 2025-%Y, Artezaru.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">

  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.4.7.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  <!-- # L10n: Setting the PST URL as an argument as this does not need to be localized -->
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.16.1.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>